# PostgresAI Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                PostgresAI Stack                                    │
│                                                                                     │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐                │
│  │   Nginx Proxy   │    │   Tailscale     │    │   External      │                │
│  │   SSL/HTTPS     │    │   VPN Access    │    │   Access        │                │
│  │   :80, :443     │    │   Secure Route  │    │   via Domain    │                │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘                │
│           │                       │                       │                        │
│           │              ┌────────┴───────────────────────┴────────┐               │
│           │              │         Docker Network                  │               │
│           │              │         172.20.0.0/16                   │               │
│           │              │                                         │               │
│  ┌────────┴──────────────┴─────────────────────────────────────────┴─────────────┐ │
│  │                          Application Layer                                    │ │
│  │                                                                               │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐               │ │
│  │  │   OpenWebUI     │  │   TinyBERT      │  │   pgAdmin       │               │ │
│  │  │   Web Interface │  │   Transformers  │  │   DB Admin      │               │ │
│  │  │   :8081         │  │   :8083         │  │   :5051         │               │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘               │ │
│  │           │                     │                     │                       │ │
│  │           │                     │                     │                       │ │
│  │  ┌────────┴─────────┐  ┌────────┴─────────┐  ┌────────┴─────────┐             │ │
│  │  │   Ollama API     │  │   Python Flask   │  │   DBeaver        │             │ │
│  │  │   LLM Engine     │  │   ML Models      │  │   CloudBeaver    │             │ │
│  │  │   :11434         │  │   Embeddings     │  │   :8978          │             │ │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘             │ │
│  │           │                                             │                     │ │
│  └───────────┼─────────────────────────────────────────────┼─────────────────────┘ │
│              │                                             │                       │
│  ┌───────────┼─────────────────────────────────────────────┼─────────────────────┐ │
│  │           │              Data Layer                     │                     │ │
│  │           │                                             │                     │ │
│  │  ┌────────┴─────────┐  ┌─────────────────┐  ┌───────────┴─────────┐           │ │
│  │  │   Model Storage  │  │   PostgreSQL    │  │   Application       │           │ │
│  │  │   Ollama Models  │  │   Database      │  │   Data Storage      │           │ │
│  │  │   deepseek:latest│  │   :65432        │  │   Persistent Vols   │           │ │
│  │  │   llama2:13b-q4  │  │   postgres_ai   │  │   Config Files      │           │ │
│  │  └──────────────────┘  └─────────────────┘  └─────────────────────┘           │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘

Port Mappings:
┌──────────────┬──────────────┬──────────────┬────────────────────────────────────┐
│   Service    │ External Port│ Internal Port│              Purpose               │
├──────────────┼──────────────┼──────────────┼────────────────────────────────────┤
│ PostgreSQL   │    65432     │     5432     │ Database connections               │
│ pgAdmin      │    5051      │      80      │ Database administration            │
│ DBeaver      │    8978      │     8978     │ Database IDE                       │
│ OpenWebUI    │    8081      │     8080     │ LLM Chat Interface                 │
│ Ollama API   │    11434     │    11434     │ LLM API endpoints                  │
│ TinyBERT     │    8083      │     8083     │ Text embeddings & similarity       │
│ Nginx HTTP   │     80       │      80      │ HTTP redirects to HTTPS            │
│ Nginx HTTPS  │    443       │     443      │ SSL/TLS termination                │
└──────────────┴──────────────┴──────────────┴────────────────────────────────────┘

Volume Mappings:
┌──────────────────────┬─────────────────────────────────────────────────────────┐
│      Volume Name     │                    Purpose                              │
├──────────────────────┼─────────────────────────────────────────────────────────┤
│ postgres_data        │ PostgreSQL database files                              │
│ pg_data              │ Alternative PostgreSQL data storage                    │
│ pgadmin_data         │ pgAdmin configuration and session data                 │
│ dbeaver_data         │ DBeaver workspace and connections                      │
│ open-webui-data      │ OpenWebUI conversations and settings                   │
│ ollama_data          │ Ollama models and runtime data                         │
│ ollama_model_loader_data │ Model loading and caching                          │
│ ollama_loader        │ Alternative model storage                              │
│ tinybert_models      │ TinyBERT model cache                                   │
│ tailscale_data       │ Tailscale VPN configuration                            │
│ nginx_logs           │ Nginx access and error logs                            │
└──────────────────────┴─────────────────────────────────────────────────────────┘

Data Flow:
┌─────────────┐    HTTPS/443   ┌─────────────┐    Internal    ┌─────────────┐
│   Client    │───────────────→│    Nginx    │───────────────→│   Services  │
│  (Browser)  │                │  SSL Proxy  │                │    Backend  │
└─────────────┘                └─────────────┘                └─────────────┘
       │                              │                              │
       │ Tailscale VPN               │ Load Balancing              │ Database
       │ External Access             │ SSL Termination             │ Queries
       ↓                              ↓                              ↓
┌─────────────┐                ┌─────────────┐                ┌─────────────┐
│  Tailscale  │                │   Routing   │                │ PostgreSQL  │
│   Network   │                │ & Security  │                │  Database   │
└─────────────┘                └─────────────┘                └─────────────┘

Security Features:
• SSL/TLS encryption for all web traffic
• Tailscale VPN for secure external access
• Docker network isolation (172.20.0.0/16)
• Environment-based configuration
• Persistent volume encryption (filesystem level)
• Container-to-container communication via internal DNS

AI/ML Pipeline:
User Input → OpenWebUI → Ollama API → AI Models (DeepSeek/Llama2) → Response
     ↓              ↓           ↓              ↓                      ↓
Text Analysis → TinyBERT → Embeddings → PostgreSQL → Stored Results
     ↓              ↓           ↓              ↓                      ↓
Database Ops → pgAdmin/DBeaver → SQL Queries → Analysis → Reports
```
